"use strict";(self.webpackChunkcelo_docs=self.webpackChunkcelo_docs||[]).push([[8423],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return d}});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=r.createContext({}),s=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},p=function(e){var t=s(e.components);return r.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},y=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,p=a(e,["components","mdxType","originalType","parentName"]),y=s(n),d=o,u=y["".concat(l,".").concat(d)]||y[d]||m[d]||i;return n?r.createElement(u,c(c({ref:t},p),{},{components:n})):r.createElement(u,c({ref:t},p))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,c=new Array(i);c[0]=y;var a={};for(var l in t)hasOwnProperty.call(t,l)&&(a[l]=t[l]);a.originalType=e,a.mdxType="string"==typeof e?e:o,c[1]=a;for(var s=2;s<i;s++)c[s]=n[s];return r.createElement.apply(null,c)}return r.createElement.apply(null,n)}y.displayName="MDXCreateElement"},91821:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return a},contentTitle:function(){return l},metadata:function(){return s},toc:function(){return p},default:function(){return y}});var r=n(83117),o=n(80102),i=(n(67294),n(3905)),c=["components"],a={title:"Celo Encrypted Payment Comments",description:"Overview of encrypted payment comments and its technical details related to symmetric and asymmetric encryption."},l="Encrypted Payment Comments",s={unversionedId:"celo-codebase/protocol/transactions/tx-comment-encryption",id:"celo-codebase/protocol/transactions/tx-comment-encryption",title:"Celo Encrypted Payment Comments",description:"Overview of encrypted payment comments and its technical details related to symmetric and asymmetric encryption.",source:"@site/docs/celo-codebase/protocol/transactions/tx-comment-encryption.md",sourceDirName:"celo-codebase/protocol/transactions",slug:"/celo-codebase/protocol/transactions/tx-comment-encryption",permalink:"/celo-codebase/protocol/transactions/tx-comment-encryption",editUrl:"https://github.com/celo-org/docs/edit/main/docs/celo-codebase/protocol/transactions/tx-comment-encryption.md",tags:[],version:"current",frontMatter:{title:"Celo Encrypted Payment Comments",description:"Overview of encrypted payment comments and its technical details related to symmetric and asymmetric encryption."},sidebar:"docs",previous:{title:"Celo's Escrow Contract",permalink:"/celo-codebase/protocol/transactions/escrow"},next:{title:"Celo Full Node Incentives",permalink:"/celo-codebase/protocol/transactions/full-node-incentives"}},p=[{value:"Introduction to Comment Encryption",id:"introduction-to-comment-encryption",children:[],level:3},{value:"Comment Encryption Technical Details",id:"comment-encryption-technical-details",children:[{value:"\u200cSymmetric Encryption (AES-128-CTR)",id:"symmetric-encryption-aes-128-ctr",children:[],level:4},{value:"Asymmetric Encryption (ECIES)",id:"asymmetric-encryption-ecies",children:[],level:4}],level:3}],m={toc:p};function y(e){var t=e.components,n=(0,o.Z)(e,c);return(0,i.kt)("wrapper",(0,r.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"encrypted-payment-comments"},"Encrypted Payment Comments"),(0,i.kt)("p",null,"Overview of encrypted payment comments and its technical details related to symmetric and asymmetric encryption."),(0,i.kt)("hr",null),(0,i.kt)("h3",{id:"introduction-to-comment-encryption"},"Introduction to Comment Encryption"),(0,i.kt)("p",null,"As part of Celo\u2019s identity protocol, a public encryption key is stored along with a user\u2019s address in the ",(0,i.kt)("inlineCode",{parentName:"p"},"Accounts")," contract. "),(0,i.kt)("p",null,"Both the address key pair and the encryption key pair are derived from the backup phrase. When sending a transaction the encryption key of the recipient is retrieved when getting his or her address. The comment is then encrypted using a 128 bit hybrid encryption scheme ","(","ECDH on secp256k1 with AES-128-CTR",")",". This system ensures that comments can only be read by the sending and receiving parties and that messages will be recovered when restoring a wallet from its backup phrase."),(0,i.kt)("h3",{id:"comment-encryption-technical-details"},"Comment Encryption Technical Details"),(0,i.kt)("p",null,"A 128 bit randomly generated session key, sk, is generated and used to symmetrically encrypt the comment. sk is asymmetrically encrypted to the sender and to the recipient."),(0,i.kt)("p",null,"\u200c",(0,i.kt)("inlineCode",{parentName:"p"},"Encrypted = ECIES(sk, to=pubSelf) | ECIES(sk, to=pubOther) | AES(ke=sk, km=sk, comment)")),(0,i.kt)("h4",{id:"symmetric-encryption-aes-128-ctr"},"\u200cSymmetric Encryption ","(","AES-128-CTR",")"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Takes encryption key, ke, and MAC key, km, and the data to encrypt, plaintext"),(0,i.kt)("li",{parentName:"ul"},"Cipher: AES-128-CTR using a randomly generated iv"),(0,i.kt)("li",{parentName:"ul"},"Authenticate iv ","|"," ciphertext using HMAC with SHA-256 and km"),(0,i.kt)("li",{parentName:"ul"},"Return iv ","|"," ciphertext ","|"," mac")),(0,i.kt)("h4",{id:"asymmetric-encryption-ecies"},"Asymmetric Encryption ","(","ECIES",")"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Takes data to encrypt, plaintext, and the public key of the recipient, pubKeyTo"),(0,i.kt)("li",{parentName:"ol"},"Generate an ephemeral keypair, ephemPubKey and ephemPrivKey"),(0,i.kt)("li",{parentName:"ol"},"Derive 32 bytes of key material, k, from ECDH between ephemPrivKey and pubKeyTousing ConcatKDF ","(","specified as NIST 800-56C Rev 1 One Step KDF",")"," with SHA-256 for H","(","x",")"),(0,i.kt)("li",{parentName:"ol"},"The encryption key, ke, is the first 128 bits of k"),(0,i.kt)("li",{parentName:"ol"},"The MAC key, km, is SHA-256 of the second 128 bits of k"),(0,i.kt)("li",{parentName:"ol"},"Encrypt the plaintext symmetrically with AES-128-CTR using ke, km, and a random iv"),(0,i.kt)("li",{parentName:"ol"},"Return ephemPubKey ","|"," AES-128-CTR-HMAC","(","ke, km, plaintext",")"," where the public key needs to be uncompressed ","(","current limitation with decrypt",")",".")))}y.isMDXComponent=!0}}]);