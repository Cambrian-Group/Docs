"use strict";(self.webpackChunkcelo_docs=self.webpackChunkcelo_docs||[]).push([[9657],{3905:function(e,t,o){o.d(t,{Zo:function(){return d},kt:function(){return h}});var a=o(67294);function r(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function n(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function i(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?n(Object(o),!0).forEach((function(t){r(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e,t){if(null==e)return{};var o,a,r=function(e,t){if(null==e)return{};var o,a,r={},n=Object.keys(e);for(a=0;a<n.length;a++)o=n[a],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(a=0;a<n.length;a++)o=n[a],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}var s=a.createContext({}),c=function(e){var t=a.useContext(s),o=t;return e&&(o="function"==typeof e?e(t):i(i({},t),e)),o},d=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var o=e.components,r=e.mdxType,n=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=c(o),h=r,f=u["".concat(s,".").concat(h)]||u[h]||p[h]||n;return o?a.createElement(f,i(i({ref:t},d),{},{components:o})):a.createElement(f,i({ref:t},d))}));function h(e,t){var o=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var n=o.length,i=new Array(n);i[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var c=2;c<n;c++)i[c]=o[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,o)}u.displayName="MDXCreateElement"},34305:function(e,t,o){o.r(t),o.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return c},toc:function(){return d},default:function(){return u}});var a=o(83117),r=o(80102),n=(o(67294),o(3905)),i=["components"],l={title:"Celo Validator Elections",description:"Introduction to Celo validator elections and management of groups and votes throughout the process."},s="Validator Elections",c={unversionedId:"celo-codebase/protocol/proof-of-stake/validator-elections",id:"celo-codebase/protocol/proof-of-stake/validator-elections",title:"Celo Validator Elections",description:"Introduction to Celo validator elections and management of groups and votes throughout the process.",source:"@site/docs/celo-codebase/protocol/proof-of-stake/validator-elections.md",sourceDirName:"celo-codebase/protocol/proof-of-stake",slug:"/celo-codebase/protocol/proof-of-stake/validator-elections",permalink:"/celo-codebase/protocol/proof-of-stake/validator-elections",editUrl:"https://github.com/celo-org/docs/edit/main/docs/celo-codebase/protocol/proof-of-stake/validator-elections.md",tags:[],version:"current",frontMatter:{title:"Celo Validator Elections",description:"Introduction to Celo validator elections and management of groups and votes throughout the process."},sidebar:"docs",previous:{title:"Locked CELO and Voting",permalink:"/celo-codebase/protocol/proof-of-stake/locked-gold"},next:{title:"Celo Epoch Rewards Overview",permalink:"/celo-codebase/protocol/proof-of-stake/epoch-rewards"}},d=[{value:"Updating the Active Validator Set",id:"updating-the-active-validator-set",children:[{value:"Group Voting Caps",id:"group-voting-caps",children:[],level:3},{value:"Goal of Validator Elections",id:"goal-of-validator-elections",children:[],level:3},{value:"Handling Excess Votes",id:"handling-excess-votes",children:[],level:3},{value:"Per-Group Vote Cap",id:"per-group-vote-cap",children:[],level:3},{value:"Adding New Validators",id:"adding-new-validators",children:[],level:3}],level:2},{value:"Running the Election",id:"running-the-election",children:[{value:"Filtering Groups",id:"filtering-groups",children:[],level:3},{value:"Assigning Seats",id:"assigning-seats",children:[],level:3},{value:"Number of Active Validators",id:"number-of-active-validators",children:[],level:3}],level:2}],p={toc:d};function u(e){var t=e.components,o=(0,r.Z)(e,i);return(0,n.kt)("wrapper",(0,a.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"validator-elections"},"Validator Elections"),(0,n.kt)("p",null,"Introduction to Celo validator elections and management of groups and votes throughout the process."),(0,n.kt)("hr",null),(0,n.kt)("h2",{id:"updating-the-active-validator-set"},"Updating the Active Validator Set"),(0,n.kt)("p",null,"The active validator set is updated by running an election in the final block of each epoch, after processing transactions and ",(0,n.kt)("a",{parentName:"p",href:"/celo-codebase/protocol/proof-of-stake/epoch-rewards"},"Epoch Rewards"),"."),(0,n.kt)("h3",{id:"group-voting-caps"},"Group Voting Caps"),(0,n.kt)("p",null,"One way to consider the security of a proof-of-stake system is the marginal cost of getting a malicious validator elected. In a steady state, assuming the Celo community set the incentives appropriately, a full complement of validators is likely to be elected, which means the attack cost is the cost of acquiring sufficient CELO to receive more votes than the currently elected validator with fewest votes, and thereby supplant it."),(0,n.kt)("h3",{id:"goal-of-validator-elections"},"Goal of Validator Elections"),(0,n.kt)("p",null,"The objective of Celo\u2019s validator elections differs from real-world elections: they aim to translate voter preferences into representation while promoting decentralization and creating a moat around existing, well-performing elected validators. Two design choices influence this: a limit on the maximum number of member validator that a group can list, and a ",(0,n.kt)("strong",{parentName:"p"},"voting cap")," on the number of votes that any one group can receive."),(0,n.kt)("h3",{id:"handling-excess-votes"},"Handling Excess Votes"),(0,n.kt)("p",null,"Since voting for a group can cause only the group\u2019s member validators to get elected, and no more, votes in excess of the number needed to achieve that are unproductive in the sense that they do not raise the number of votes needed to get the least-voted-for validator elected. This would translate into a lower cost for a malicious actor to acquire enough CELO to supplant that validator. This is particularly true because the protocol limits the maximum number of members in a group, to promote decentralization."),(0,n.kt)("h3",{id:"per-group-vote-cap"},"Per-Group Vote Cap"),(0,n.kt)("p",null,"The Celo protocol addresses this by enforcing a per-group vote cap. This cap is set to be the number of votes that would be needed to elect all of its validators, plus one more validator. The cap is enforced at the point of voting: a user can only cast a vote for a group if it currently has fewer votes than this cap. An account holder may not set or increase the amount of gold they have voting for a particular validator group ",(0,n.kt)("inlineCode",{parentName:"p"},"j"),", if it already has at least ",(0,n.kt)("inlineCode",{parentName:"p"},"[(group_members_j + 1) / min(total_group_members, max_validators)]")," of the total Locked Gold."),(0,n.kt)("h3",{id:"adding-new-validators"},"Adding New Validators"),(0,n.kt)("p",null,"If a group adds a new validator, or the total amount of voting Locked Gold increases, the group\u2019s cap rises and new votes are permitted. If a group removes a validator or a validator chooses to leave, or the total amount of voting Locked Gold falls, then the group\u2019s cap falls: if it has more votes than this new cap, then new votes are no longer permitted, but all existing votes continue to be counted."),(0,n.kt)("p",null,"The Celo protocol allows an account to divide its vote between up to ten groups, since there may be cases where the vote cap prevents an account allocating its entire vote to its first choice group."),(0,n.kt)("h2",{id:"running-the-election"},"Running the Election"),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://storage.googleapis.com/celo-website/docs/election.jpg",alt:null})),(0,n.kt)("p",null,"The ",(0,n.kt)("inlineCode",{parentName:"p"},"Election")," contract is called from the IBFT block finalization code to select the validators for the following epoch. The contract maintains a sorted list of the Locked Gold voting (either pending or activated) for each Validator Group. The ",(0,n.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/D'Hondt_method"},"D\u2019Hondt method"),", a closed party list form of proportional representation, is applied to iteratively select validators from the Validator Groups with the greatest associated vote balances."),(0,n.kt)("h3",{id:"filtering-groups"},"Filtering Groups"),(0,n.kt)("p",null,"The list of groups is first filtered to remove those that have not achieved a certain fraction of the votes of the total voting Locked Gold."),(0,n.kt)("h3",{id:"assigning-seats"},"Assigning Seats"),(0,n.kt)("p",null,"Then, in the first iteration, the algorithm assigns the first seat to the group that has at least one member and with the most votes. Thereafter, it assigns the seat to the group that would \u2018pay\u2019, if its next validator were elected, the highest vote averaged over its candidates that have been selected so far plus the one under consideration."),(0,n.kt)("h3",{id:"number-of-active-validators"},"Number of Active Validators"),(0,n.kt)("p",null,"There is a minimum target and a maximum cap on the number of active validators that may be selected. If the minimum target is not reached, the election aborts and no change is made to the validator set this epoch."))}u.isMDXComponent=!0}}]);