"use strict";(self.webpackChunkcelo_docs=self.webpackChunkcelo_docs||[]).push([[1076],{3905:function(e,t,a){a.d(t,{Zo:function(){return c},kt:function(){return h}});var n=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var s=n.createContext({}),d=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=d(e.components);return n.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=d(a),h=o,m=p["".concat(s,".").concat(h)]||p[h]||u[h]||r;return a?n.createElement(m,i(i({ref:t},c),{},{components:a})):n.createElement(m,i({ref:t},c))}));function h(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,i=new Array(r);i[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var d=2;d<r;d++)i[d]=a[d];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}p.displayName="MDXCreateElement"},164:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return d},toc:function(){return c},default:function(){return p}});var n=a(3117),o=a(102),r=(a(7294),a(3905)),i=["components"],l={title:"Run Baklava Testnet Validator on Celo",description:"How to get a Validator node running on the Celo Mainnet (Celo's Node Operator Testnet)."},s="Run Baklava Testnet Validator",d={unversionedId:"getting-started/baklava-testnet/running-a-validator-in-baklava",id:"getting-started/baklava-testnet/running-a-validator-in-baklava",title:"Run Baklava Testnet Validator on Celo",description:"How to get a Validator node running on the Celo Mainnet (Celo's Node Operator Testnet).",source:"@site/docs/getting-started/baklava-testnet/running-a-validator-in-baklava.md",sourceDirName:"getting-started/baklava-testnet",slug:"/getting-started/baklava-testnet/running-a-validator-in-baklava",permalink:"/getting-started/baklava-testnet/running-a-validator-in-baklava",editUrl:"",tags:[],version:"current",frontMatter:{title:"Run Baklava Testnet Validator on Celo",description:"How to get a Validator node running on the Celo Mainnet (Celo's Node Operator Testnet)."}},c=[{value:"Why run a Baklava Testnet Validator?",id:"why-run-a-baklava-testnet-validator",children:[],level:2},{value:"Prerequisites",id:"prerequisites",children:[{value:"Staking Requirements",id:"staking-requirements",children:[],level:3},{value:"Hardware requirements",id:"hardware-requirements",children:[],level:3},{value:"Networking requirements",id:"networking-requirements",children:[],level:3},{value:"Software requirements",id:"software-requirements",children:[{value:"On each machine",id:"on-each-machine",children:[],level:4},{value:"On your local machine",id:"on-your-local-machine",children:[],level:4}],level:3},{value:"Key Management",id:"key-management",children:[{value:"Unlocking",id:"unlocking",children:[],level:4}],level:3},{value:"Environment variables",id:"environment-variables",children:[],level:3}],level:2},{value:"Validator Node Setup",id:"validator-node-setup",children:[{value:"Environment Variables",id:"environment-variables-1",children:[],level:3},{value:"Pull the Celo Docker image",id:"pull-the-celo-docker-image",children:[{value:"Account Creation",id:"account-creation",children:[{value:"Account and Signer keys",id:"account-and-signer-keys",children:[],level:5},{value:"Generating Validator and Validator Group Keys",id:"generating-validator-and-validator-group-keys",children:[],level:5}],level:4}],level:3},{value:"Start your Accounts node",id:"start-your-accounts-node",children:[],level:3},{value:"Deploy a Validator",id:"deploy-a-validator",children:[{value:"Proof-of-Possession",id:"proof-of-possession",children:[],level:4}],level:3},{value:"Deploy a proxy",id:"deploy-a-proxy",children:[],level:3},{value:"Get your Proxy&#39;s connection info",id:"get-your-proxys-connection-info",children:[],level:3},{value:"Connect the Validator to the Proxy",id:"connect-the-validator-to-the-proxy",children:[],level:3}],level:2},{value:"Registering as a Validator",id:"registering-as-a-validator",children:[{value:"Register the Accounts",id:"register-the-accounts",children:[],level:3},{value:"Lock up CELO",id:"lock-up-celo",children:[],level:3},{value:"Run for election",id:"run-for-election",children:[],level:3}],level:2},{value:"Running the Attestation Service",id:"running-the-attestation-service",children:[],level:2},{value:"Deployment Tips",id:"deployment-tips",children:[{value:"Running the Docker containers in the background",id:"running-the-docker-containers-in-the-background",children:[],level:3},{value:"Stopping containers",id:"stopping-containers",children:[],level:3}],level:2}],u={toc:c};function p(e){var t=e.components,a=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"run-baklava-testnet-validator"},"Run Baklava Testnet Validator"),(0,r.kt)("p",null,"How to get a Validator node running on the Celo Baklava Testnet (Celo's Node Operator Testnet)."),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"why-run-a-baklava-testnet-validator"},"Why run a Baklava Testnet Validator?"),(0,r.kt)("p",null,"The Baklava testnet is the best place to get started running a validator, or test out new validator configurations before deploying to ",(0,r.kt)("a",{parentName:"p",href:"/getting-started/mainnet"},"Mainnet"),"."),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"If you would like to keep up-to-date with all the news happening in the Celo community, including validation, node operation and governance, please sign up to our ",(0,r.kt)("a",{parentName:"p",href:"https://celo.activehosted.com/f/15"},"Celo Signal mailing list here"),"."),(0,r.kt)("p",{parentName:"div"},"You can add the ",(0,r.kt)("a",{parentName:"p",href:"https://calendar.google.com/calendar/u/0/embed?src=c_9su6ich1uhmetr4ob3sij6kaqs@group.calendar.google.com"},"Celo Signal public calendar")," as well which has relevant dates."))),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"If you are transitioning from the Baklava network prior to the June 24 reset, you will need to start with a fresh chain database. You can create new nodes from fresh machines, as described in this guide, or you may delete your chaindata folder, which is named ",(0,r.kt)("inlineCode",{parentName:"p"},"celo")," in the node data directory, and start over by running the provided ",(0,r.kt)("inlineCode",{parentName:"p"},"init")," commands for each node described below. All on-chain registration steps, the commands completed with ",(0,r.kt)("inlineCode",{parentName:"p"},"celocli"),", will need to be run on the new network."),(0,r.kt)("p",{parentName:"div"},"Key differences are:"),(0,r.kt)("ul",{parentName:"div"},(0,r.kt)("li",{parentName:"ul"},"New network ID is ",(0,r.kt)("inlineCode",{parentName:"li"},"62320")),(0,r.kt)("li",{parentName:"ul"},"A new image has been pushed to ",(0,r.kt)("inlineCode",{parentName:"li"},"us.gcr.io/celo-org/geth:baklava")),(0,r.kt)("li",{parentName:"ul"},"A new genesis block, bootnode enode, and the new network ID are included in the Docker image")))),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("h3",{id:"staking-requirements"},"Staking Requirements"),(0,r.kt)("p",null,"Celo uses a ",(0,r.kt)("a",{parentName:"p",href:"/celo-codebase/protocol/proof-of-stake"},"proof-of-stake")," consensus mechanism, which requires Validators to have locked CELO to participate in block production. The current requirement is 10,000 CELO to register a Validator, and 10,000 CELO ",(0,r.kt)("em",{parentName:"p"},"per member validator")," to register a Validator Group."),(0,r.kt)("p",null,"Participating in the Baklava testnet requires testnet units of CELO, which can only be used in the Baklava testnet. You can request a distribution of testnet CELO by filling out ",(0,r.kt)("a",{parentName:"p",href:"https://forms.gle/JTYkMAJWTAUQp1sv9"},"the faucet request form"),". If you need any help getting started, please join the discussion on ",(0,r.kt)("a",{parentName:"p",href:"https://chat.celo.org"},"Discord")," or email ",(0,r.kt)("a",{parentName:"p",href:"mailto:community@celo.org"},"community@celo.org"),"."),(0,r.kt)("p",null,"Faucetted funds will come as 2 transactions, one for your validator address and another for your validator group address."),(0,r.kt)("h3",{id:"hardware-requirements"},"Hardware requirements"),(0,r.kt)("p",null,"The recommended Celo Validator setup involves continually running three instances:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"1 ",(0,r.kt)("strong",{parentName:"li"},"Validator node"),": should be deployed to single-tenant hardware in a secure, high availability data center"),(0,r.kt)("li",{parentName:"ul"},"1 ",(0,r.kt)("strong",{parentName:"li"},"Validator Proxy node"),": can be a VM or container in a multi-tenant environment (e.g. a public cloud), but requires high availability"),(0,r.kt)("li",{parentName:"ul"},"1 ",(0,r.kt)("strong",{parentName:"li"},"Attestation node"),": can be a VM or container in a multi-tenant environment (e.g. a public cloud), and has moderate availability requirements")),(0,r.kt)("p",null,"Celo is a proof-of-stake network, which has different hardware requirements than a Proof of Work network. proof-of-stake consensus is less CPU intensive, but is more sensitive to network connectivity and latency. Below is a list of standard requirements for running Validator and Proxy nodes on the Celo Network:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Memory: 8 GB RAM"),(0,r.kt)("li",{parentName:"ul"},"CPU: Quad core 3GHz (64-bit)"),(0,r.kt)("li",{parentName:"ul"},"Disk: 256 GB of SSD storage, plus a secondary HDD desirable"),(0,r.kt)("li",{parentName:"ul"},"Network: At least 1 GB input/output Ethernet with a fiber Internet connection, ideally redundant connections and HA switches")),(0,r.kt)("p",null,"Attestation Service nodes consume less resources and can run on machines with less memory and compute."),(0,r.kt)("p",null,"In addition, to get things started, it will be useful to run a node on your local machine that you can issue CLI commands against."),(0,r.kt)("h3",{id:"networking-requirements"},"Networking requirements"),(0,r.kt)("p",null,"In order for your Validator to participate in consensus and complete attestations, it is ",(0,r.kt)("strong",{parentName:"p"},"critically")," important to configure your network correctly."),(0,r.kt)("p",null,"Your Proxy and Attestations nodes must have static, external IP addresses, and your Validator node must be able to communicate with the Proxy, either via an internal network or via the Proxy's external IP address."),(0,r.kt)("p",null,"On the Validator machine, port 30503 should accept TCP connections from the IP address of your Proxy machine. This port is used by the Validator to communicate with the Proxy."),(0,r.kt)("p",null,"On the Proxy machine, port 30503 should accept TCP connections from the IP address of your Validator machine. This port is used by the Proxy to communicate with the Validator."),(0,r.kt)("p",null,"On the Proxy and Attestations machines, port 30303 should accept TCP and UDP connections from all IP addresses. This port is used to communicate with other nodes in the network."),(0,r.kt)("p",null,"On the Attestations machine, port 80 should accept TCP connections from all IP addresses. This port is used by users to request attestations from you."),(0,r.kt)("p",null,"To illustrate this, you may refer to the following table:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Machine ","\\"," IPs open to"),(0,r.kt)("th",{parentName:"tr",align:null},"0",".","0",".","0",".","0/0 ","(","all",")"),(0,r.kt)("th",{parentName:"tr",align:null},"your","-","validator","-","ip"),(0,r.kt)("th",{parentName:"tr",align:null},"your","-","proxy","-","ip"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Validator"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null},"tcp:30503")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Proxy"),(0,r.kt)("td",{parentName:"tr",align:null},"tcp:30303, udp:30303"),(0,r.kt)("td",{parentName:"tr",align:null},"tcp:30503"),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Attestation"),(0,r.kt)("td",{parentName:"tr",align:null},"tcp:80"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null})))),(0,r.kt)("h3",{id:"software-requirements"},"Software requirements"),(0,r.kt)("h4",{id:"on-each-machine"},"On each machine"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"You have Docker installed.")),(0,r.kt)("p",{parentName:"li"},"If you don\u2019t have it already, follow the instructions here: ",(0,r.kt)("a",{parentName:"p",href:"https://www.docker.com/get-started"},"Get Started with Docker"),". It will involve creating or signing in with a Docker account, downloading a desktop app, and then launching the app to be able to use the Docker CLI. If you are running on a Linux server, follow the instructions for your distro ",(0,r.kt)("a",{parentName:"p",href:"https://docs.docker.com/install/#server"},"here"),". You may be required to run Docker with ",(0,r.kt)("inlineCode",{parentName:"p"},"sudo")," depending on your installation environment.\nYou can check you have Docker installed and running if the command ",(0,r.kt)("inlineCode",{parentName:"p"},"docker info")," works properly."))),(0,r.kt)("h4",{id:"on-your-local-machine"},"On your local machine"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"You have celocli installed."))),(0,r.kt)("p",null,"for instructions on how to get set up."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"You are using the latest Node.js 12.x")),(0,r.kt)("p",{parentName:"li"},"Some users have reported issues using the most recent version of node. Use the LTS for greater reliability."))),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"A note about conventions:\nThe code snippets you'll see on this page are bash commands and their output."),(0,r.kt)("p",{parentName:"div"},"When you see text in angle brackets ","<",">",", replace them and the text inside with your own value of what it refers to. Don't include the ","<",">"," in the command."))),(0,r.kt)("h3",{id:"key-management"},"Key Management"),(0,r.kt)("p",null,"Private keys are the central primitive of any cryptographic system and need to be handled with extreme care. Loss of your private key can lead to irreversible loss of value."),(0,r.kt)("p",null,"This guide contains a large number of keys, so it is important to understand the purpose of each key. ",(0,r.kt)("a",{parentName:"p",href:"/validator-guide/summary"},"Read more about key management.")),(0,r.kt)("h4",{id:"unlocking"},"Unlocking"),(0,r.kt)("p",null,'Celo nodes store private keys encrypted on disk with a password, and need to be "unlocked" before use. Private keys can be unlocked in two ways:'),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"By running the ",(0,r.kt)("inlineCode",{parentName:"li"},"celocli account:unlock"),' command. Note that the node must have the "personal" RPC API enabled in order for this command to work.'),(0,r.kt)("li",{parentName:"ol"},"By setting the ",(0,r.kt)("inlineCode",{parentName:"li"},"--unlock")," flag when starting the node.")),(0,r.kt)("p",null,"It is important to note that when a key is unlocked you need to be particularly careful about enabling access to the node's RPC APIs."),(0,r.kt)("h3",{id:"environment-variables"},"Environment variables"),(0,r.kt)("p",null,"There are a number of environment variables in this guide, and you may use this table as a reference."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Variable"),(0,r.kt)("th",{parentName:"tr",align:null},"Explanation"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CELO_IMAGE"),(0,r.kt)("td",{parentName:"tr",align:null},"The Docker image used for the Validator and proxy containers")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CELO_VALIDATOR_GROUP_ADDRESS"),(0,r.kt)("td",{parentName:"tr",align:null},"The account address for the Validator Group")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CELO_VALIDATOR_ADDRESS"),(0,r.kt)("td",{parentName:"tr",align:null},"The account address for the Validator")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CELO_VALIDATOR_GROUP_SIGNER_ADDRESS"),(0,r.kt)("td",{parentName:"tr",align:null},"The validator (group) signer address authorized by the Validator Group account.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CELO_VALIDATOR_GROUP_SIGNER_SIGNATURE"),(0,r.kt)("td",{parentName:"tr",align:null},"The proof-of-possession of the Validator Group signer key")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CELO_VALIDATOR_SIGNER_ADDRESS"),(0,r.kt)("td",{parentName:"tr",align:null},"The validator signer address authorized by the Validator Account")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CELO_VALIDATOR_SIGNER_PUBLIC_KEY"),(0,r.kt)("td",{parentName:"tr",align:null},"The ECDSA public key associated with the Validator signer address")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CELO_VALIDATOR_SIGNER_SIGNATURE"),(0,r.kt)("td",{parentName:"tr",align:null},"The proof-of-possession of the Validator signer key")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CELO_VALIDATOR_SIGNER_BLS_PUBLIC_KEY"),(0,r.kt)("td",{parentName:"tr",align:null},"The BLS public key for the Validator instance")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CELO_VALIDATOR_SIGNER_BLS_SIGNATURE"),(0,r.kt)("td",{parentName:"tr",align:null},"A proof-of-possession of the BLS public key")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CELO_VALIDATOR_GROUP_VOTE_SIGNER_ADDRESS"),(0,r.kt)("td",{parentName:"tr",align:null},"The address of the Validator Group vote signer")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CELO_VALIDATOR_GROUP_VOTE_SIGNER_PUBLIC_KEY"),(0,r.kt)("td",{parentName:"tr",align:null},"The ECDSA public key associated with the Validator Group vote signer address")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CELO_VALIDATOR_GROUP_VOTE_SIGNER_SIGNATURE"),(0,r.kt)("td",{parentName:"tr",align:null},"The proof-of-possession of the Validator Group vote signer key")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CELO_VALIDATOR_VOTE_SIGNER_ADDRESS"),(0,r.kt)("td",{parentName:"tr",align:null},"The address of the Validator vote signer")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CELO_VALIDATOR_VOTE_SIGNER_PUBLIC_KEY"),(0,r.kt)("td",{parentName:"tr",align:null},"The ECDSA public key associated with the Validator vote signer address")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CELO_VALIDATOR_VOTE_SIGNER_SIGNATURE"),(0,r.kt)("td",{parentName:"tr",align:null},"The proof-of-possession of the Validator vote signer key")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"PROXY_ENODE"),(0,r.kt)("td",{parentName:"tr",align:null},"The enode address for the Validator proxy")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"PROXY_INTERNAL_IP"),(0,r.kt)("td",{parentName:"tr",align:null},"(Optional) The internal IP address over which your Validator can communicate with your proxy")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"PROXY_EXTERNAL_IP"),(0,r.kt)("td",{parentName:"tr",align:null},"The external IP address of the proxy. May be used by the Validator to communicate with the proxy if PROXY_INTERNAL_IP is unspecified")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CELO_ATTESTATION_SIGNER_ADDRESS"),(0,r.kt)("td",{parentName:"tr",align:null},"The address of the attestation signer authorized by the Validator Account")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CELO_ATTESTATION_SIGNER_SIGNATURE"),(0,r.kt)("td",{parentName:"tr",align:null},"The proof-of-possession of the attestation signer key")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"CELO_ATTESTATION_SERVICE_URL"),(0,r.kt)("td",{parentName:"tr",align:null},"The URL to access the deployed Attestation Service")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"METADATA_URL"),(0,r.kt)("td",{parentName:"tr",align:null},"The URL to access the metadata file for your Attestation Service")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DATABASE_URL"),(0,r.kt)("td",{parentName:"tr",align:null},"The URL under which your database is accessible, currently supported are ",(0,r.kt)("inlineCode",{parentName:"td"},"postgres://"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"mysql://")," and ",(0,r.kt)("inlineCode",{parentName:"td"},"sqlite://"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"APP_SIGNATURE"),(0,r.kt)("td",{parentName:"tr",align:null},"The hash with which clients can auto-read SMS messages on android")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"SMS_PROVIDERS"),(0,r.kt)("td",{parentName:"tr",align:null},"A comma-separated list of providers you want to configure, Celo currently supports ",(0,r.kt)("inlineCode",{parentName:"td"},"nexmo")," & ",(0,r.kt)("inlineCode",{parentName:"td"},"twilio"))))),(0,r.kt)("h2",{id:"validator-node-setup"},"Validator Node Setup"),(0,r.kt)("p",null,"This section outlines the steps needed to configure your Proxy and Validator nodes so that they are ready to sign blocks once elected."),(0,r.kt)("h3",{id:"environment-variables-1"},"Environment Variables"),(0,r.kt)("p",null,"First we are going to set up the main environment variables related to the Baklava network. Run these on both your ",(0,r.kt)("strong",{parentName:"p"},"Validator")," and ",(0,r.kt)("strong",{parentName:"p"},"Proxy")," machines:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"export CELO_IMAGE=us.gcr.io/celo-org/geth:baklava\n")),(0,r.kt)("h3",{id:"pull-the-celo-docker-image"},"Pull the Celo Docker image"),(0,r.kt)("p",null,"In all the commands we are going to see the ",(0,r.kt)("inlineCode",{parentName:"p"},"CELO_IMAGE")," variable to refer to the Docker image to use. Now we can get the Docker image on your Validator and Proxy machines:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker pull $CELO_IMAGE\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"us.gcr.io/celo-org/geth:baklava")," image contains the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/celo-org/celo-monorepo/tree/master/packages/celotool/genesis_baklava.json"},"genesis block")," in addition to the Celo Blockchain binary."),(0,r.kt)("h4",{id:"account-creation"},"Account Creation"),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Please complete this section if you are new to validating on Celo."))),(0,r.kt)("h5",{id:"account-and-signer-keys"},"Account and Signer keys"),(0,r.kt)("p",null,"Running a Celo Validator node requires the management of several different keys, each with different privileges. Keys that need to be accessed frequently (e.g. for signing blocks) are at greater risk of being compromised, and thus have more limited permissions, while keys that need to be accessed infrequently (e.g. for locking CELO) are less onerous to store securely, and thus have more expansive permissions. Below is a summary of the various keys that are used in the Celo network, and a description of their permissions."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Name of the key"),(0,r.kt)("th",{parentName:"tr",align:null},"Purpose"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Account key"),(0,r.kt)("td",{parentName:"tr",align:null},"This is the key with the highest level of permissions, and is thus the most sensitive. It can be used to lock and unlock CELO, and authorize vote, validator, and attestation keys. Note that the account key also has all of the permissions of the other keys.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Validator signer key"),(0,r.kt)("td",{parentName:"tr",align:null},"This is the key that has permission to register and manage a Validator or Validator Group, and participate in BFT consensus.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Vote signer key"),(0,r.kt)("td",{parentName:"tr",align:null},"This key can be used to vote in Validator elections and on-chain governance.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Attestation signer key"),(0,r.kt)("td",{parentName:"tr",align:null},"This key is used to sign attestations in Celo's lightweight identity protocol.")))),(0,r.kt)("p",null,"Note that Account and all the signer keys must be unique and may not be reused."),(0,r.kt)("h5",{id:"generating-validator-and-validator-group-keys"},"Generating Validator and Validator Group Keys"),(0,r.kt)("p",null,"First, you'll need to generate account keys for your Validator and Validator Group."),(0,r.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"danger")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"These keys will control your locked CELO, and thus should be handled with care.\nStore and back these keys up in a secure manner, as there will be no way to recover them if lost or stolen."))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your local machine\nmkdir celo-accounts-node\ncd celo-accounts-node\ndocker run -v $PWD:/root/.celo --rm -it $CELO_IMAGE account new\ndocker run -v $PWD:/root/.celo --rm -it $CELO_IMAGE account new\n")),(0,r.kt)("p",null,"This will create a new keystore in the current directory with two new accounts.\nCopy the addresses from the terminal and set the following environment variables:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your local machine\nexport CELO_VALIDATOR_GROUP_ADDRESS=<YOUR-VALIDATOR-GROUP-ADDRESS>\nexport CELO_VALIDATOR_ADDRESS=<YOUR-VALIDATOR-ADDRESS>\n")),(0,r.kt)("h3",{id:"start-your-accounts-node"},"Start your Accounts node"),(0,r.kt)("p",null,"Next, we'll run a node on your local machine so that we can use these accounts to lock CELO and authorize the keys needed to run your validator."),(0,r.kt)("p",null,"To run the node:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your local machine\nmkdir celo-accounts-node\ncd celo-accounts-node\ndocker run --name celo-accounts -it --restart always --stop-timeout 300 -p 127.0.0.1:8545:8545 -v $PWD:/root/.celo $CELO_IMAGE --verbosity 3 --syncmode full --http --http.addr 0.0.0.0 --http.api eth,net,web3,debug,admin,personal --baklava --light.serve 0 --datadir /root/.celo\n")),(0,r.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"danger")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},(0,r.kt)("strong",{parentName:"p"},"Security"),": The command line above includes the parameter ",(0,r.kt)("inlineCode",{parentName:"p"},"--http.addr 0.0.0.0")," which makes the Celo Blockchain software listen for incoming RPC requests on all network adaptors. Exercise extreme caution in doing this when running outside Docker, as it means that any unlocked accounts and their funds may be accessed from other machines on the Internet. In the context of running a Docker container on your local machine, this together with the ",(0,r.kt)("inlineCode",{parentName:"p"},"docker -p 127.0.0.1:localport:containerport")," flags allows you to make RPC calls from outside the container, i.e from your local host, but not from outside your machine. Read more about ",(0,r.kt)("a",{parentName:"p",href:"https://docs.docker.com/network/network-tutorial-standalone/#use-user-defined-bridge-networks"},"Docker Networking")," here."))),(0,r.kt)("h3",{id:"deploy-a-validator"},"Deploy a Validator"),(0,r.kt)("p",null,"To actually register as a validator, we'll need to generate a validating signer key. On your Validator machine (which should not be accessible from the public internet), follow very similar steps:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On the validator machine\n# Note that you have to export $CELO_IMAGE on this machine\nexport CELO_IMAGE=us.gcr.io/celo-org/geth:baklava\nmkdir celo-validator-node\ncd celo-validator-node\ndocker run -v $PWD:/root/.celo --rm -it $CELO_IMAGE account new\nexport CELO_VALIDATOR_SIGNER_ADDRESS=<YOUR-VALIDATOR-SIGNER-ADDRESS>\n")),(0,r.kt)("h4",{id:"proof-of-possession"},"Proof-of-Possession"),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Please complete this step if you are running a validator on Celo for the first time."))),(0,r.kt)("p",null,"In order to authorize our Validator signer, we need to create a proof that we have possession of the Validator signer private key. We do so by signing a message that consists of the Validator account address. To generate the proof-of-possession, run the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On the validator machine\n# Note that you have to export CELO_VALIDATOR_ADDRESS on this machine\nexport CELO_VALIDATOR_ADDRESS=<CELO-VALIDATOR-ADDRESS>\ndocker run -v $PWD:/root/.celo --rm -it $CELO_IMAGE account proof-of-possession $CELO_VALIDATOR_SIGNER_ADDRESS $CELO_VALIDATOR_ADDRESS\n")),(0,r.kt)("p",null,"Save the signer address, public key, and proof-of-possession signature to your local machine:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your local machine\nexport CELO_VALIDATOR_SIGNER_ADDRESS=<YOUR-VALIDATOR-SIGNER-ADDRESS>\nexport CELO_VALIDATOR_SIGNER_SIGNATURE=<YOUR-VALIDATOR-SIGNER-SIGNATURE>\nexport CELO_VALIDATOR_SIGNER_PUBLIC_KEY=<YOUR-VALIDATOR-SIGNER-PUBLIC-KEY>\n")),(0,r.kt)("p",null,"Validators on the Celo network use BLS aggregated signatures to create blocks in addition to the Validator signer (ECDSA) key. While an independent BLS key can be specified, the simplest thing to do is to derive the BLS key from the Validator signer key. When we register our Validator, we'll need to prove possession of the BLS key as well, which can be done by running the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On the validator machine\ndocker run -v $PWD:/root/.celo --rm -it $CELO_IMAGE account proof-of-possession $CELO_VALIDATOR_SIGNER_ADDRESS $CELO_VALIDATOR_ADDRESS --bls\n")),(0,r.kt)("p",null,"Save the resulting signature and public key to your local machine:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your local machine\nexport CELO_VALIDATOR_SIGNER_BLS_SIGNATURE=<YOUR-VALIDATOR-SIGNER-SIGNATURE>\nexport CELO_VALIDATOR_SIGNER_BLS_PUBLIC_KEY=<YOUR-VALIDATOR-SIGNER-BLS-PUBLIC-KEY>\n")),(0,r.kt)("p",null,"We'll get back to this machine later, but for now, let's give it a proxy."),(0,r.kt)("h3",{id:"deploy-a-proxy"},"Deploy a proxy"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On the proxy machine\nmkdir celo-proxy-node\ncd celo-proxy-node\nexport CELO_VALIDATOR_SIGNER_ADDRESS=<YOUR-VALIDATOR-SIGNER-ADDRESS>\n")),(0,r.kt)("p",null,"You can then run the proxy with the following command. Be sure to replace ",(0,r.kt)("inlineCode",{parentName:"p"},"<YOUR-VALIDATOR-NAME>")," with the name you'd like to appear on Celostats. The validator name shown in ",(0,r.kt)("a",{parentName:"p",href:"https://baklava-celostats.celo-testnet.org/"},"Celostats")," will be the name configured in the proxy."),(0,r.kt)("p",null,"Additionally, you need to unlock the account configured in the ",(0,r.kt)("inlineCode",{parentName:"p"},"etherbase")," option. It is recommended to create a new account and independent account only for this purpose. Be sure to write a new password to ",(0,r.kt)("inlineCode",{parentName:"p"},"./.password")," for this account (different to the Validator Signer password)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On the proxy machine\n# First, we create a new account for the proxy\ndocker run --name celo-proxy-password -it --rm  -v $PWD:/root/.celo $CELO_IMAGE account new --password /root/.celo/.password\n")),(0,r.kt)("p",null,"Notice the public address returned by this command, that can be exported and used for running the proxy node:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On the proxy machine\nexport PROXY_ADDRESS=<PROXY-PUBLIC-ADDRESS>\ndocker run --name celo-proxy -it --restart unless-stopped --stop-timeout 300 -p 30303:30303 -p 30303:30303/udp -p 30503:30503 -p 30503:30503/udp -v $PWD:/root/.celo $CELO_IMAGE --verbosity 3 --syncmode full --proxy.proxy --proxy.proxiedvalidatoraddress $CELO_VALIDATOR_SIGNER_ADDRESS --proxy.internalendpoint :30503 --etherbase $PROXY_ADDRESS --unlock $PROXY_ADDRESS --password /root/.celo/.password --allow-insecure-unlock --baklava --datadir /root/.celo --celostats=<YOUR-VALIDATOR-NAME>@baklava-celostats-server.celo-testnet.org\n")),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"You can detach from the running container by pressing ",(0,r.kt)("inlineCode",{parentName:"p"},"ctrl+p ctrl+q"),", or start it with ",(0,r.kt)("inlineCode",{parentName:"p"},"-d")," instead of ",(0,r.kt)("inlineCode",{parentName:"p"},"-it")," to start detached. Access the logs for a container in the background with the ",(0,r.kt)("inlineCode",{parentName:"p"},"docker logs")," command."))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"NOTES")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"For the proxy to be able to send stats to ",(0,r.kt)("a",{parentName:"li",href:"https://baklava-celostats.celo-testnet.org/"},"Celostats"),", both the proxy and the validator should set the ",(0,r.kt)("inlineCode",{parentName:"li"},"celostats")," flag"),(0,r.kt)("li",{parentName:"ul"},"If you are deploying multiple proxies for the same validator, the ",(0,r.kt)("inlineCode",{parentName:"li"},"celostats")," flag should be added in only one of them")),(0,r.kt)("h3",{id:"get-your-proxys-connection-info"},"Get your Proxy's connection info"),(0,r.kt)("p",null,"Once the Proxy is running, we will need to retrieve its enode and IP address so that the Validator will be able to connect to it."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On the proxy machine, retrieve the proxy enode\ndocker exec celo-proxy geth --exec \"admin.nodeInfo['enode'].split('//')[1].split('@')[0]\" attach | tr -d '\"'\n")),(0,r.kt)("p",null,"Now we need to set the Proxy enode and Proxy IP address in environment variables on the Validator machine."),(0,r.kt)("p",null,"If you don't have an internal IP address over which the Validator and Proxy can communicate, you can set the internal IP address to the external IP address."),(0,r.kt)("p",null,"If you don't know your proxy's external IP address, you can get it by running the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On the proxy machine\ndig +short myip.opendns.com @resolver1.opendns.com\n")),(0,r.kt)("p",null,"Then, export the variables on your Validator machine."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On the Validator machine\nexport PROXY_ENODE=<YOUR-PROXY-ENODE>\nexport PROXY_EXTERNAL_IP=<PROXY-MACHINE-EXTERNAL-IP-ADDRESS>\nexport PROXY_INTERNAL_IP=<PROXY-MACHINE-INTERNAL-IP-ADDRESS>\n")),(0,r.kt)("p",null,"You will also need to export ",(0,r.kt)("inlineCode",{parentName:"p"},"PROXY_EXTERNAL_IP")," on your local machine."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your local machine\nexport PROXY_EXTERNAL_IP=<PROXY-MACHINE-EXTERNAL-IP-ADDRESS>\n")),(0,r.kt)("h3",{id:"connect-the-validator-to-the-proxy"},"Connect the Validator to the Proxy"),(0,r.kt)("p",null,"When your Validator starts up it will attempt to create a network connection with the proxy machine. You will need to make sure that your proxy machine has the appropriate firewall settings to allow the Validator to connect to it."),(0,r.kt)("p",null,"Specifically, on the proxy machine, port 30303 should allow TCP and UDP connections from all IP addresses. And port 30503 should allow TCP connections from the IP address of your Validator machine."),(0,r.kt)("p",null,"Test that your network is configured correctly by running the following commands:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your local machine, test that your proxy is accepting TCP connections over port 30303.\n# Note that it will also need to be accepting UDP connections over this port.\nnc -vz $PROXY_EXTERNAL_IP 30303\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your Validator machine, test that your proxy is accepting TCP connections over port 30503.\nnc -vz $PROXY_INTERNAL_IP 30503\n")),(0,r.kt)("p",null,"Once that is completed, go ahead and run the Validator. Be sure to write your Validator signer password to ",(0,r.kt)("inlineCode",{parentName:"p"},"./.password")," for the following command to work, or provide your password another way."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On the Validator machine\ncd celo-validator-node\ndocker run --name celo-validator -it --restart unless-stopped --stop-timeout 300 -p 30303:30303 -p 30303:30303/udp -v $PWD:/root/.celo $CELO_IMAGE --verbosity 3 --syncmode full --mine --etherbase $CELO_VALIDATOR_SIGNER_ADDRESS --nodiscover --proxy.proxied --proxy.proxyenodeurlpairs=enode://$PROXY_ENODE@$PROXY_INTERNAL_IP:30503\\;enode://$PROXY_ENODE@$PROXY_EXTERNAL_IP:30303 --unlock=$CELO_VALIDATOR_SIGNER_ADDRESS --password /root/.celo/.password --celostats=<YOUR-VALIDATOR-NAME>@baklava-celostats-server.celo-testnet.org --baklava --datadir /root/.celo\n")),(0,r.kt)("p",null,"At this point your Validator and Proxy machines should be configured, and both should be syncing to the network. You should see ",(0,r.kt)("inlineCode",{parentName:"p"},"Imported new chain segment")," in your node logs, about once every 5 seconds once the node is synced to the latest block which you can find on the ",(0,r.kt)("a",{parentName:"p",href:"https://baklava-celostats.celo-testnet.org/"},"Baklava Network Stats")," page."),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"You can run multiple proxies by deploying additional proxies per the instructions in the ",(0,r.kt)("a",{parentName:"p",href:"/getting-started/baklava-testnet/running-a-validator-in-baklava#deploy-a-proxy"},"Deploy a proxy")," section. Then add all of the proxies' enodes as a comma seperated list using the ",(0,r.kt)("inlineCode",{parentName:"p"},"--proxy.proxyenodeurlpairs")," option. E.g. if there are two proxies, that option's usage would look like ",(0,r.kt)("inlineCode",{parentName:"p"},"--proxy.proxyenodeurlpairs=enode://$PROXY_ENODE_1@$PROXY_INTERNAL_IP_1:30503\\;enode://$PROXY_ENODE_1@$PROXY_EXTERNAL_IP_1:30303,enode://$PROXY_ENODE_2@$PROXY_INTERNAL_IP_2:30503\\;enode://$PROXY_ENODE_2@$PROXY_EXTERNAL_IP_2:30303")))),(0,r.kt)("h2",{id:"registering-as-a-validator"},"Registering as a Validator"),(0,r.kt)("h3",{id:"register-the-accounts"},"Register the Accounts"),(0,r.kt)("p",null,"You've now done all the infrastructure setup to get a validator and proxy running. The cLabs team will review your submission to receive funds and send you 12,000 Baklava testnet CELO to each of your Validator and Validator Group account addresses. These funds have no real world value but will allow you to submit transactions to the network and put up a stake to register as a validator and validator group."),(0,r.kt)("p",null,"You can view your CELO balances by running the following commands:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your local machine\ncelocli account:balance $CELO_VALIDATOR_GROUP_ADDRESS\ncelocli account:balance $CELO_VALIDATOR_ADDRESS\n")),(0,r.kt)("p",null,"At some point the output of these commands will change from ",(0,r.kt)("inlineCode",{parentName:"p"},"0")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"12e12"),", indicating you have received the testnet CELO. This process involves a human, so please be patient. If you haven't received a balance within 24 hours, please get in touch again."),(0,r.kt)("p",null,"You can also look at an account's current balance and transaction history on ",(0,r.kt)("a",{parentName:"p",href:"https://baklava-blockscout.celo-testnet.org/"},"Blockscout"),". Enter the address into the search bar."),(0,r.kt)("p",null,"Once these accounts have a balance, unlock them so that we can sign transactions. Then, we will register the accounts with the Celo core smart contracts:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your local machine\ncelocli account:unlock $CELO_VALIDATOR_GROUP_ADDRESS\ncelocli account:unlock $CELO_VALIDATOR_ADDRESS\ncelocli account:register --from $CELO_VALIDATOR_GROUP_ADDRESS --name <NAME YOUR VALIDATOR GROUP>\ncelocli account:register --from $CELO_VALIDATOR_ADDRESS --name <NAME YOUR VALIDATOR>\n")),(0,r.kt)("p",null,"Check that your accounts were registered successfully with the following commands:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your local machine\ncelocli account:show $CELO_VALIDATOR_GROUP_ADDRESS\ncelocli account:show $CELO_VALIDATOR_ADDRESS`\n")),(0,r.kt)("h3",{id:"lock-up-celo"},"Lock up CELO"),(0,r.kt)("p",null,"Lock up testnet CELO for both accounts in order to secure the right to register a Validator and Validator Group. The current requirement is 10,000 CELO to register a validator, and 10,000 CELO ",(0,r.kt)("em",{parentName:"p"},"per member validator")," to register a Validator Group. For Validators, this gold remains locked for approximately 60 days following deregistration. For groups, this gold remains locked for approximately 60 days following the removal of the Nth validator from the group."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your local machine\ncelocli lockedgold:lock --from $CELO_VALIDATOR_GROUP_ADDRESS --value 10000000000000000000000\ncelocli lockedgold:lock --from $CELO_VALIDATOR_ADDRESS --value 10000000000000000000000\n")),(0,r.kt)("p",null,"This amount (10,000 CELO) represents the minimum amount needed to be locked in order to register a Validator and Validator group. Since your balance is in fact higher than this, you may wish to lock more with these accounts. Note that you will want to be sure to leave enough CELO unlocked to be able to continue to pay transaction fees for future transactions (such as those issued by running some CLI commands)."),(0,r.kt)("p",null,"Check that your CELO was successfully locked with the following commands:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your local machine\ncelocli lockedgold:show $CELO_VALIDATOR_GROUP_ADDRESS\ncelocli lockedgold:show $CELO_VALIDATOR_ADDRESS\n")),(0,r.kt)("h3",{id:"run-for-election"},"Run for election"),(0,r.kt)("p",null,"In order to be elected as a Validator, you will first need to register your group and Validator. Note that when registering a Validator Group, you need to specify a ",(0,r.kt)("a",{parentName:"p",href:"/celo-codebase/protocol/proof-of-stake/validator-groups#group-share"},"commission"),", which is the fraction of epoch rewards paid to the group by its members."),(0,r.kt)("p",null,"We don't want to use our account key for validating, so first let's authorize the validator signing key:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your local machine\ncelocli account:authorize --from $CELO_VALIDATOR_ADDRESS --role validator --signature 0x$CELO_VALIDATOR_SIGNER_SIGNATURE --signer 0x$CELO_VALIDATOR_SIGNER_ADDRESS\n")),(0,r.kt)("p",null,"Confirm by checking the authorized Validator signer for your Validator:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your local machine\ncelocli account:show $CELO_VALIDATOR_ADDRESS\n")),(0,r.kt)("p",null,"Then, register your Validator Group by running the following command. Note that because we did not authorize a Validator signer for our Validator Group account, we register the Validator Group with the account key."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your local machine\ncelocli validatorgroup:register --from $CELO_VALIDATOR_GROUP_ADDRESS --commission 0.1\n")),(0,r.kt)("p",null,"You can view information about your Validator Group by running the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your local machine\ncelocli validatorgroup:show $CELO_VALIDATOR_GROUP_ADDRESS\n")),(0,r.kt)("p",null,"Next, register your Validator by running the following command. Note that because we have authorized a Validator signer, this step could also be performed on the Validator machine. Running it on the local machine allows us to avoid needing to install "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your local machine\ncelocli validator:register --from $CELO_VALIDATOR_ADDRESS --ecdsaKey $CELO_VALIDATOR_SIGNER_PUBLIC_KEY --blsKey $CELO_VALIDATOR_SIGNER_BLS_PUBLIC_KEY --blsSignature $CELO_VALIDATOR_SIGNER_BLS_SIGNATURE\n")),(0,r.kt)("p",null,"Affiliate your Validator with your Validator Group. Note that you will not be a member of this group until the Validator Group accepts you. This command could also be run from the Validator signer, if running on the validator machine."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your local machine\ncelocli validator:affiliate $CELO_VALIDATOR_GROUP_ADDRESS --from $CELO_VALIDATOR_ADDRESS\n")),(0,r.kt)("p",null,"Accept the affiliation:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your local machine\ncelocli validatorgroup:member --accept $CELO_VALIDATOR_ADDRESS --from $CELO_VALIDATOR_GROUP_ADDRESS\n")),(0,r.kt)("p",null,"Next, double check that your Validator is now a member of your Validator Group:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your local machine\ncelocli validator:show $CELO_VALIDATOR_ADDRESS\ncelocli validatorgroup:show $CELO_VALIDATOR_GROUP_ADDRESS\n")),(0,r.kt)("p",null,"Use both accounts to vote for your Validator Group. Note that because we have not authorized a vote signer for either account, these transactions must be sent from the account keys. Since you're likely to need to place additional votes throughout the course of the stake-off, consider creating and authorizing vote signers for additional operational security."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your local machine\ncelocli election:vote --from $CELO_VALIDATOR_ADDRESS --for $CELO_VALIDATOR_GROUP_ADDRESS --value 10000000000000000000000\ncelocli election:vote --from $CELO_VALIDATOR_GROUP_ADDRESS --for $CELO_VALIDATOR_GROUP_ADDRESS --value 10000000000000000000000\n")),(0,r.kt)("p",null,"Double check that your votes were cast successfully:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your local machine\ncelocli election:show $CELO_VALIDATOR_GROUP_ADDRESS --group\ncelocli election:show $CELO_VALIDATOR_GROUP_ADDRESS --voter\ncelocli election:show $CELO_VALIDATOR_ADDRESS --voter\n")),(0,r.kt)("p",null,"Users in the Celo protocol receive epoch rewards for voting in Validator Elections only after submitting a special transaction to enable them. This must be done every time new votes are cast, and can only be made after the most recent epoch has ended. For convenience, we can use the following command, which will wait until the epoch has ended before sending a transaction:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your local machine\n# Note that this may take some time, as the epoch needs to end before votes can be activated\ncelocli election:activate --from $CELO_VALIDATOR_ADDRESS --wait && celocli election:activate --from $CELO_VALIDATOR_GROUP_ADDRESS --wait\n")),(0,r.kt)("p",null,"Check that your votes were activated by re-running the following commands:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your local machine\ncelocli election:show $CELO_VALIDATOR_GROUP_ADDRESS --voter\ncelocli election:show $CELO_VALIDATOR_ADDRESS --voter\n")),(0,r.kt)("p",null,"If your Validator Group elects validators, you will receive epoch rewards in the form of additional Locked CELO voting for your Validator Group from your account addresses. You can see these rewards accumulate with the commands in the previous set, as well as:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your local machine\ncelocli lockedgold:show $CELO_VALIDATOR_GROUP_ADDRESS\ncelocli lockedgold:show $CELO_VALIDATOR_ADDRESS\n")),(0,r.kt)("p",null,"You're all set! Elections are finalized at the end of each epoch, roughly once an hour in the Alfajores or Baklava Testnets. After that hour, if you get elected, your node will start participating BFT consensus and validating blocks. After the first epoch in which your Validator participates in BFT, you should receive your first set of epoch rewards."),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},(0,r.kt)("strong",{parentName:"p"},"Roadmap"),": Different parameters will govern elections in a Celo production network. Epochs are likely to be daily, rather than hourly. Running a Validator will also include setting up proxy nodes to protect against DDoS attacks, and using hardware wallets to secure the key used to sign blocks. We plan to update these instructions with more details soon."))),(0,r.kt)("p",null,"You can inspect the current state of the validator elections by running:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your local machine\ncelocli election:list\n")),(0,r.kt)("p",null,"If you find your Validator still not getting elected you may need to faucet yourself more funds and lock more gold in order to be able to cast more votes for your Validator Group!"),(0,r.kt)("p",null,"You can check the status of your validator, including whether it is elected and signing blocks, at ",(0,r.kt)("a",{parentName:"p",href:"https://baklava-ethstats.celo-testnet.org"},"baklava-ethstats.celo-testnet.org")," or by running:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your local machine with celocli >= 0.0.30-beta9\ncelocli validator:status --validator $CELO_VALIDATOR_ADDRESS\n")),(0,r.kt)("p",null,"You can see additional information about your validator, including uptime score, by running:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# On your local machine\ncelocli validator:show $CELO_VALIDATOR_ADDRESS\n")),(0,r.kt)("h2",{id:"running-the-attestation-service"},"Running the Attestation Service"),(0,r.kt)("p",null,"Validators are expected to run an ",(0,r.kt)("a",{parentName:"p",href:"/validator-guide/attestation-service"},"Attestation Service")," to provide attestations that allow users to map their phone number to an account on Celo. Follow the instructions now to ",(0,r.kt)("a",{parentName:"p",href:"/validator-guide/attestation-service"},"set up the service"),"."),(0,r.kt)("h2",{id:"deployment-tips"},"Deployment Tips"),(0,r.kt)("h3",{id:"running-the-docker-containers-in-the-background"},"Running the Docker containers in the background"),(0,r.kt)("p",null,"There are different options for executing Docker containers in the background. The most typical one is to use in your docker run commands the ",(0,r.kt)("inlineCode",{parentName:"p"},"-d")," option. Also for long running processes, especially when you run in on a remote machine, you can use a tool like ",(0,r.kt)("a",{parentName:"p",href:"https://ss64.com/osx/screen.html"},"screen"),". It allows you to connect and disconnect from running processes providing an easy way to manage long running processes."),(0,r.kt)("p",null,"It's out of the scope of this documentation to go through the ",(0,r.kt)("inlineCode",{parentName:"p"},"screen")," options, but you can use the following command format with your ",(0,r.kt)("inlineCode",{parentName:"p"},"docker")," commands:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"screen -S <SESSION NAME> -d -m <YOUR COMMAND>\n")),(0,r.kt)("p",null,"For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"screen -S celo-validator -d -m docker run --name celo-validator -it --restart unless-stopped --stop-timeout 300 -p 127.0.0.1:8545:8545 .......\n")),(0,r.kt)("p",null,"You can list your existing ",(0,r.kt)("inlineCode",{parentName:"p"},"screen")," sessions:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"screen -ls\n")),(0,r.kt)("p",null,"And re-attach to any of the existing sessions:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"screen -r -S celo-validator\n")),(0,r.kt)("h3",{id:"stopping-containers"},"Stopping containers"),(0,r.kt)("p",null,"You can stop the Docker containers at any time without problem. If you stop your containers that means those containers stop providing service.\nThe data directory of the Validator and the proxy are Docker volumes mounted in the containers from the ",(0,r.kt)("inlineCode",{parentName:"p"},"celo-*-dir")," you created at the very beginning. So if you don't remove that folder, you can stop or restart the containers without losing any data."),(0,r.kt)("p",null,"It is recommended to use the Docker stop timeout parameter ",(0,r.kt)("inlineCode",{parentName:"p"},"-t")," when stopping the containers. This allows time, in this case 60 seconds, for the Celo nodes to flush recent chain data it keeps in memory into the data directories. Omitting this may cause your blockchain data to corrupt, requiring the node to start syncing from scratch."),(0,r.kt)("p",null,"You can stop the ",(0,r.kt)("inlineCode",{parentName:"p"},"celo-validator")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"celo-proxy")," containers running:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker stop celo-validator celo-proxy -t 60\n")),(0,r.kt)("p",null,"And you can remove the containers (not the data directory) by running:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker rm -f celo-validator celo-proxy\n")))}p.isMDXComponent=!0}}]);